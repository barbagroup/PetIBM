<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PetIBM: Use PetIBM API</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PetIBM<span id="projectnumber">&#160;0.5.4</span>
   </div>
   <div id="projectbrief">Toolbox and applications of the immersed-boundary method for distributed-memory architectures</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('da/d23/md_doc_markdowns_usepetibmapi.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Use PetIBM API </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >In the installation path, PetIBM also provides a library and header files that have all necessary API to build a flow solver.</p>
<h1>API Documentation</h1>
<p >The API documentation can be found in the <b>Modules</b> section of the <a href="https://barbagroup.github.io/PetIBM/modules.html">Doxygen pages</a>. The subsection of <b>PetIBM building blocks</b> shows details of the elements for building a flow solver. The subsection of <b>Flow solvers and utilities</b> shows the flow solvers built on those building blocks.</p>
<p >A local version of Doxygen pages can be created with the <code>doxygen</code> utility. To do that, go into the <code>doc</code> folder of PetIBM, and run the <code>doxygen</code> command. HTML pages will be created in the subfolder <code>html</code> of the <code>doc</code> directory. Users can, then, open the main page of the manual, <code>html/index.html</code>, using their preferred browser.</p>
<h1>API usage examples</h1>
<p >The source code of the flow solvers mentioned in the API documentation may be unfriendly for beginners, so we provide other simplified solvers in the folder <code>$PETIBM_DIR/examples/api_examples</code>. For example, <code>liddrivencavity2d</code> provides step-by-step instructions in the comments of the source code. (See the README files in those folders for additional details.)</p>
<h1>Compiling and linking against PetIBM</h1>
<h2>Header files</h2>
<p >Let <code>$PETIBM_INSTALL</code> be the installation path of PetIBM. All header files for public PetIBM API are under <code>$PETIBM_INSTALL/include/petibm</code>, while those for third-party dependencies, if any, are under <code>$PETIBM_INSTALL/include</code>. For example, if users configure PetIBM using the flag <code>--enable-amgxwrapper</code>, the header file <code>AmgXSolver.hpp</code> will be copied to <code>$PETIBM_INSTALL/include</code>.</p>
<p >There are many headers of PetIBM, while only the top-level ones are normally used in an application code:</p>
<ul>
<li><code><a class="el" href="../../df/def/type_8h.html" title="Definition of user-defined types for convenience.">type.h</a></code>: useful data types in PetIBM,</li>
<li><code><a class="el" href="../../d5/d36/parser_8h.html" title="Prototypes of parser functions.">parser.h</a></code>: functions to parse <a class="el" href="../../d7/d1e/namespace_y_a_m_l.html">YAML</a> input file,</li>
<li><code><a class="el" href="../../d8/d3b/mesh_8h.html" title="Prototype of mesh::MeshBase, type::Mesh, and factory function.">mesh.h</a></code>: abstract mesh object and its factory functions,</li>
<li><code><a class="el" href="../../d4/daa/boundary_8h.html" title="boundary::BoundaryBase, type::Boundary, and factory function.">boundary.h</a></code>: abstract boundary (and ghost points) object and its factory functions,</li>
<li><code><a class="el" href="../../d7/dac/solution_8h.html" title="Definition of the class petibm::solution::SolutionBase, the type definition petibm::type::Solution,...">solution.h</a></code>: abstract solution object and its factory functions,</li>
<li><code><a class="el" href="../../d7/d79/operators_8h.html" title="Prototypes of factory functions for operators.">operators.h</a></code>: factory functions for creating operators (matrices),</li>
<li><code><a class="el" href="../../d6/d19/linsolver_8h.html" title="Def. of LinSolverBase, LinSolver, and factory function.">linsolver.h</a></code>: abstract object for linear solvers and its factory functions,</li>
<li><code><a class="el" href="../../d8/d1c/bodypack_8h.html" title="body::BodyPackBase, type::BodyPack, and factory function.">bodypack.h</a></code>: abstract object for multi-body holders and its factory functions,</li>
<li><code><a class="el" href="../../dd/d82/timeintegration_8h.html" title="Definition of TimeIntegration related classes.">timeintegration.h</a></code>: abstract object for temporal integration and its factory functions.</li>
</ul>
<p >To compile with PetIBM headers, remember to have <code>-I$PETIBM_INSTALL/include</code> in the compilation flags. Also, the path to PETSc headers is necessary, e.g., <code>-I$PETSC_DIR/PETSC_ARCH/include</code>.</p>
<p >If users provide their own installations of third-party dependencies to build PetIBM, remember to also include those paths. For example, if users provide <code>--with-yamlcpp-dir=$YAMLCPP_DIR</code> during configuration, then they will have to add <code>-I$YAMLCPP_DIR/include</code> to the compilation flags.</p>
<h2>Library</h2>
<p >PetIBM provides two libraries, <code>libpetibm.so</code> and <code>libpetibmapps.so</code> (or their corresponding static libraries). <code>libpetibm.so</code> provides basic components for writing a solver without inheriting from any existing solvers. The mentioned <code>liddrivencavity2d</code> is an example of only using <code>libpetibm.so</code>. On the other hand, <code>libpetibmapps.so</code> provides basic flow solvers for derived classes. For example, the <code>oscillatingcylinder</code> case in <code>api_examples</code> uses <code>libpetibmapps.so</code>. Both libraries are located in <code>$PETIBM_INSTALL/lib</code>; use <code>-L$PETIBM_INSTALL/lib -lpetibm -lpetibmapps</code> to link.</p>
<p >There may be other libraries in <code>$PETIBM_INSTALL/lib</code>, depending on how users configure PetIBM. For example, if a user lets PetIBM installs yaml-cpp automatically, then the yaml-cpp library will be installed along with the PetIBM library in <code>$PETIBM_INSTALL/lib</code>. (Note: on some systems or OS, third-party libraries may be installed in <code>$PETIBM_INSTALL/lib64</code>.)</p>
<p >If users use CMake to build applications, using PetIBM libraries should be easy. PetIBM ships its own CMake config file. It means in CMake, just use <code>find_package</code> to find PetIBM and all dependencies (AmgX, PETSc, etc., **_except for MPI_**). For example (a snippet from the <code>liddrivencavity2d</code> API example): </p><div class="fragment"><div class="line">set(CMAKE_PREFIX_PATH ${PETIBM_DIR} ${CMAKE_PREFIX_PATH})</div>
<div class="line">find_package(MPI REQUIRED)</div>
<div class="line">find_package(petibm 0.5.4 REQUIRED)</div>
<div class="line">add_executable(liddrivencavity2d main.cpp)</div>
<div class="line">target_link_libraries(liddrivencavity2d PRIVATE MPI::MPI_CXX petibm::petibm)</div>
</div><!-- fragment --><p> With the imported targets (e.g., <code>MPI::MPI_CXX</code> and <code>petibm::petibm</code>) in modern CMake, users usually don't have to specify include directories, link directories, and secondary dependencies as long as the upstream (i.e., the developers of MPI and PetIBM in this example) configures libraries correctly.</p>
<p >If manually linking PETSc library is desired, it can be found using <code>pkg-config</code>. For example, if, in a <code>CMakeLists.txt</code>, assuming <code>PETSC_DIR</code> refers to the PETSc installation, then do </p><div class="fragment"><div class="line">set(CMAKE_PREFIX_PATH ${PETSC_DIR} ${CMAKE_PREFIX_PATH})</div>
<div class="line">find_package(PkgConfig REQUIRED)</div>
<div class="line">pkg_search_module(PETSC REQUIRED QUIET IMPORTED_TARGET petsc&gt;=3.16)</div>
</div><!-- fragment --><p> Once <code>pkg-config</code> found PETSc, legacy CMake variables prefixed with <code>PETSC_</code> will be available. Or, for modern CMake, an imported target <code>PkgConfig::PETSC</code> is available, too.</p>
<p >Alternatively, flags for linking against PETSc can be found in the file <code>$PETSC_DIR/$PETSC_ARCH/lib/petsc/conf/petscvariables</code>. (Look for the line starting with <code>PETSC_WITH_EXTERNAL_LIB =</code>.)</p>
<p >See the <code>api_examples</code> folder for more demo <code>CMakeLists.txt</code> files.</p>
<h2>Compilers</h2>
<p >If PetIBM was installed through <code>conda</code>/<code>mamba</code>, newer compilers may be needed to compile your own applications. For example, the Anaconda package of <code>petibm=0.5.4=cuda114_&lt;other tags&gt;</code> was built using <code>gxx_linux-64=11.2</code> from <code>conda-forge</code> channel. That means when you build/compile your code against this specific PetIBM version, you may need to use <code>g++</code> greater or equal to 11.2 to use newer <code>glibc</code> and <code>glibcxx</code>. The easiest way is to also use the latest tools from Anaconda, i,e., you may do (replace <code>mamba</code> with <code>conda</code> if you use the former one) </p><div class="fragment"><div class="line">$ mamba install -c conda-forge &quot;gxx_linux-64&gt;=11.2&quot; cmake make</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon May 30 2022 16:28:11 for PetIBM by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
